<!DOCTYPE html>
<html lang="fr">

<head>
	<meta charset="UTF-8">
	<title>5 - Animer avec RAF pendant 5 secondes - v2</title>

	<!-- Ajustement de la taille du viewport-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Importation de la police d'icônes de Google-->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<!-- Importation des feuilles de style-->
	<link rel="stylesheet" href="css/styles.css">
	<link rel="stylesheet" href="css/raf.css">

</head>

<body>
	<header>
		<h1>Animer avec RAF pendant 5 secondes - v2</h1>
	</header>

	<main>
		<h2 class="chargement">Temps depuis le chargement de la page : <span>0</span></h2>
		<h2 class="demarrage">Temps de démarrage de l'animation : <span>0</span></h2>

		<!-- Icône Google -->
		<span class="material-icons engrenage">
			settings
		</span>
	</main>
	<footer>
		L'animation sera arrêtée après 5 secondes avec setTimeout(fonction, delai en millisecondes);
	</footer>

	<script>
		const engrenage = document.querySelector(".engrenage");

		// Créer l'animation
		let rotation = 0;
		let idRaf = 0;
		let tempsDemarrageAnimation = 0;

		function tourner(temps) {
			engrenage.style.rotate = ++rotation + "deg";
			idRaf = requestAnimationFrame(tourner);
			console.log("Temps écoulé depuis le chargement de la page : ", temps);
			// if (temps > 5000) {
			// 	cancelAnimationFrame(idRaf);
			// }

			// Solution 1 (setTimeout) : 
			// On utilise une minuterie traditionnelle pour annuler la
			// requête d'animation après 5 secondes depuis le démarrage
			// de l'animation
			setTimeout(()=>cancelAnimationFrame(idRaf), 5000);

			
			// Solution 2 (utiliser la variable temps, mais intelligement)
			// const h2Chargement = document.querySelector(".chargement span");
			// const h2Demarrage = document.querySelector(".demarrage span");
			// Marquer à quel temps l'animation démarre
			// if(tempsDemarrageAnimation == 0) {
			// 	tempsDemarrageAnimation = temps;
			// 	h2Demarrage.innerText = tempsDemarrageAnimation;
			// }
			// // Arrêter l'animation dès que nous dépassons le temps de démarrage 
			// //  par 5000 millisecondes
			// if(temps-tempsDemarrageAnimation > 5000) {
			// 	cancelAnimationFrame(idRaf)
			// }

			h2Chargement.innerHTML = temps;
		}

		engrenage.addEventListener("click", ()=>requestAnimationFrame(tourner))


	</script>
</body>

</html>